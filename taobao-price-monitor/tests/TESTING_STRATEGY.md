# 测试策略文档

## 1. 引言

### 1.1. 目的
本文档旨在为“淘宝价格监控工具”项目定义全面的测试策略，确保项目在功能、性能、可靠性和用户体验方面达到高质量标准。本策略将指导整个测试生命周期，从测试规划、设计到执行和报告。

### 1.2. 范围
本测试策略覆盖项目的所有方面，包括：
*   **后端 API:** Flask 应用的路由、业务逻辑和数据库交互。
*   **核心功能:** 商品添加、价格抓取、价格历史记录、邮件通知。
*   **Web 前端:** 用户界面 (UI) 的交互、数据展示和用户操作的响应。
*   **数据持久化:** SQLite 数据库的完整性和一致性。
*   **配置管理:** 代理、邮箱和监控频率的设置功能。

**不在范围内的测试:**
*   第三方依赖库（如 Flask, Playwright）本身的内部功能测试。
*   SMTP 邮件服务器的性能或可靠性测试。
*   淘宝网站本身的反爬虫策略有效性测试（我们将测试我们的应对策略，而非淘宝的策略）。

## 2. 测试层级

我们将采用分层测试的方法，以确保在不同粒度上验证代码的正确性。

### 2.1. 单元测试 (Unit Testing)
*   **目标:** 验证独立的函数或模块（如 `database.py` 中的数据库操作函数, `scraper.py` 中的 URL 清理函数）的逻辑正确性。
*   **工具:** `pytest`
*   **特点:** 运行速度快，覆盖代码细节，是测试金字塔的基础。

### 2.2. 集成测试 (Integration Testing)
*   **目标:** 验证多个组件协同工作的正确性。例如，测试 Flask 的路由是否能成功调用 `scraper` 模块并更新 `database`。
*   **工具:** `pytest` 结合 `Flask-Testing` 插件。
*   **特点:** 确保模块间的接口和数据流正确无误。

### 2.3. 端到端测试 (End-to-End Testing)
*   **目标:** 模拟真实用户场景，从用户界面（浏览器）开始，完整地测试整个应用流程。例如，用户在 UI 添加商品 -> 后台成功抓取 -> 价格变动后发送邮件。
*   **工具:** `Playwright` (可复用部分抓取逻辑) 或 `Selenium`。
*   **特点:** 覆盖最真实的用户路径，是产品质量的最终保障。

## 3. 测试类型

*   **功能测试:** 确保所有功能都按预期工作。
*   **UI 测试:** 确保前端界面布局正确、响应灵敏、无显示错误。
*   **兼容性测试:** 确保 Web 应用在主流浏览器（Chrome, Firefox）的最新版本上表现一致。
*   **回归测试:** 在每次代码变更后，运行所有关键测试用例，确保新代码没有破坏现有功能。

## 4. 测试环境与数据管理

### 4.1. 测试环境
*   **本地开发环境:** 开发者在本地运行单元测试和集成测试。
*   **预发布环境 (Staging):** 在部署到生产前，在此环境运行所有测试，包括端到端测试。该环境应尽可能模拟生产环境。

### 4.2. 测试数据
*   **单元/集成测试:** 使用固定的、可重复的测试数据（Mock Data）。例如，固定的商品 URL 和预期的价格返回值。
*   **端到端测试:** 需要一个独立的测试数据库 (`test_monitor.db`)，并在测试开始前填充预设的商品数据，测试结束后清理。

## 5. 缺陷管理

*   **报告:** 发现的任何缺陷都应在项目的 Issues (例如 GitHub Issues) 中进行记录。
*   **跟踪:** 每个缺陷都应包含标题、复现步骤、预期结果、实际结果和严重等级。
*   **解决:** 开发者修复缺陷后，应将状态更新，并由测试人员进行回归验证。

## 6. 测试自动化

*   **目标:** 自动化所有单元测试和大部分集成测试。
*   **持续集成 (CI):** (推荐) 每次向主分支提交代码时，自动触发所有测试。这可以通过 GitHub Actions 等工具实现，确保代码库的健康度。

## 7. 测试交付物

*   **测试策略文档 (本文档)**
*   **测试设计文档 (`TEST_DESIGN.md`)**: 包含具体的测试用例。
*   **测试代码**: `tests/` 目录下的所有测试脚本。
*   **测试报告**: 每次测试运行后生成的覆盖率和通过率报告。
